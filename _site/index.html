<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      김인섭 &middot; 꾸준히
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" />

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>오늘도 한걸음</p>
  </div>

  <nav class="sidebar-nav">
    <a
      class="sidebar-nav-item"
      href="/"
      >홈</a
    >

                
    <a
      class="sidebar-nav-item"
      href="/about/"
      >소개</a
    >
                
    <a
      class="sidebar-nav-item"
      href="/tags/"
      >태그</a
    >
      

    <a class="sidebar-nav-item" href="https://github.com/kiminseob">깃허브</a>

    <!-- <span class="sidebar-nav-item">블로그 v1.0.0</span> -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">김인섭</a>
            <small>꾸준히</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div id="home">
  <h1>Posts</h1>
  <ul class="posts">
     
    <li>
      <a href="/2020/08/22/%E1%84%83%E1%85%A1%E1%86%BC%E1%84%80%E1%85%B3%E1%86%AB%E1%84%86%E1%85%A1%E1%84%8F%E1%85%A6%E1%86%BA-%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%86%AB-%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3/">당근마켓 클론 프로젝트</a
      ><span> &raquo; August 22, 2020</span>
    </li>
      
    <li>
      <a href="/2020/08/19/video.js%E1%84%85%E1%85%B3%E1%86%AF-%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB-%E1%84%8B%E1%85%B0%E1%86%B8-%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%A5-%E1%84%86%E1%85%A1%E1%86%AB%E1%84%83%E1%85%B3%E1%86%AF%E1%84%80%E1%85%B5/">video.js를 이용한 웹 플레이어 만들기</a
      ><span> &raquo; August 19, 2020</span>
    </li>
      
    <li>
      <a href="/2020/04/23/%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%B8%E1%84%90%E1%85%B3-API-%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%84%92%E1%85%AA-%E1%84%83%E1%85%A9%E1%84%80%E1%85%AE-JSDoc/">자바스크립트 API 문서화 도구 JSDoc</a
      ><span> &raquo; April 23, 2020</span>
    </li>
      
    <li>
      <a href="/2020/04/18/%E1%84%8F%E1%85%A9%E1%84%90%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%86%AB-%E1%84%80%E1%85%B5%E1%84%87%E1%85%A9%E1%86%AB-%E1%84%86%E1%85%AE%E1%86%AB%E1%84%87%E1%85%A5%E1%86%B8-%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5/">코틀린 기본 문법 정리</a
      ><span> &raquo; April 18, 2020</span>
    </li>
      
    <li>
      <a href="/2020/03/07/Node.js-log-%E1%84%80%E1%85%B5%E1%84%85%E1%85%A9%E1%86%A8-%E1%84%86%E1%85%A9%E1%84%83%E1%85%B2%E1%86%AF-winston-%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%87%E1%85%A1%E1%86%BC%E1%84%87%E1%85%A5%E1%86%B8/">Node.js log 기록 모듈 winston 사용방법</a
      ><span> &raquo; March 07, 2020</span>
    </li>
      
    <li>
      <a href="/2020/02/15/chocolate/">파베 초콜릿 만들기</a
      ><span> &raquo; February 15, 2020</span>
    </li>
      
    <li>
      <a href="/2014/01/01/example-content/">포스트 작성 예시</a
      ><span> &raquo; January 01, 2014</span>
    </li>
     
  </ul>
</div>
<!-- <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2020/08/22/%E1%84%83%E1%85%A1%E1%86%BC%E1%84%80%E1%85%B3%E1%86%AB%E1%84%86%E1%85%A1%E1%84%8F%E1%85%A6%E1%86%BA-%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%86%AB-%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3/">
        당근마켓 클론 프로젝트
      </a>
    </h1>

    <span class="post-date">22 Aug 2020</span>

    <h3 id="관심있는-서비스인-당근마켓을-클론해-보기로-했다">관심있는 서비스인 당근마켓을 클론해 보기로 했다.</h3>

<p>개발 스펙은 typescript, graphql, react, mysql를 이용하려고 하는데 대부분 강의 들으면서 한번 따라했던 수준이라 어떻게 될지 모르겠지만 일단 부딪혀 볼 생각이다.</p>

<p>뭐라도 만들어 봐야 감이 올 것 같기 때문에..</p>

<p>클론이 다 끝났을 때를 생각하면 결과물이 어떨지 살짝 설레기도 한다.</p>

<p>마침 <a href="https://medium.com/@taesun/%EB%8B%B9%EA%B7%BC%EB%A7%88%EC%BC%93-%ED%81%B4%EB%A1%A0%EC%BD%94%EB%94%A9-%EB%95%85%EA%B7%BC%EB%A7%88%EC%BC%93-msa-%EA%B5%AC%EC%B6%95%ED%95%B4%EB%B3%B4%EA%B8%B0-dangn-market-clone-coding-ddangn-market-0-%EA%B3%84%ED%9A%8D-%EC%84%B8%EC%9A%B0%EA%B8%B0-c50e10b486c3"><strong>여기</strong></a>에 어떤 분이 벌써 클론하신 것 같다. (대단하시다..)</p>

<p>많은 도움이 될 것 같습니다. 참고 하겠습니다!</p>

<h3 id="구체적인-기능을-정의하기에-앞서-먼저-기존-당근마켓-서비스에서-어디까지-구현해볼지-생각해-보았다">구체적인 기능을 정의하기에 앞서 먼저 기존 당근마켓 서비스에서 어디까지 구현해볼지 생각해 보았다.</h3>

<ul>
  <li>당근마켓의 5가지 탭에서 [내 근처]는 제외하고 [홈, 글쓰기, 채팅, 나의 당근] 탭을 뼈대로 만들어 볼 생각</li>
  <li>중고 거래 항목에 대한 기능만 만들어 볼 예정</li>
  <li>로그인은 휴대폰 번호 말고 (문자 인증이 유료인듯해서) OAuth를 이용할 예정</li>
</ul>

<h3 id="서버-typescript--graphql-기능은">서버 (typescript + graphql) 기능은</h3>

<ol>
  <li><strong>상품</strong>
    <ul>
      <li>상품 생성</li>
      <li>상품 제거</li>
      <li>상품 업데이트</li>
      <li>상품 전체 조회 ( 옵션 : 키워드, 카테고리, 판매자)</li>
      <li>상품 상세 조회</li>
    </ul>
  </li>
  <li><strong>나의 당근</strong>
    <ul>
      <li>판매내역 전체 조회</li>
      <li>구매내역 전체 조회</li>
      <li>관심목록 전체 조회</li>
      <li>키워드 알림 등록</li>
      <li>동네 인증 등록</li>
    </ul>
  </li>
  <li><strong>채팅</strong>
    <ul>
      <li>채팅방 생성</li>
      <li>채팅방 제거</li>
      <li>채팅하기</li>
    </ul>
  </li>
  <li><strong>알림</strong>
    <ul>
      <li>키워드 알림 발송</li>
    </ul>
  </li>
</ol>

<p>일단 이 정도로 생각해봤다.</p>

<h3 id="위-기능을-좀-더-구체화해서-api-형식으로-나타내면">위 기능을 좀 더 구체화해서 API 형식으로 나타내면</h3>

<ol>
  <li><strong>상품</strong>
    <ul>
      <li>
        <p>상품 생성 (파라미터 : 유저ID, 제목, 내용, 사진, 가격, 카테고리, 판매중/판매완료 상태)</p>

        <p><strong>POST</strong> /api/v1/products</p>

        <p>?userID={}&amp;title={}&amp;contents={}&amp;image={}&amp;price={}&amp;category={}&amp;status={selling/soldout}</p>
      </li>
      <li>
        <p>상품 업데이트 (파라미터 : 유저ID, 제목, 내용, 사진, 가격, 카테고리, 판매중/판매완료 상태)</p>

        <p><strong>PUT</strong> /api/v1/products/{product ID}</p>

        <p>?userID={}&amp;title={}&amp;contents={}&amp;image={}&amp;price={}&amp;category={}&amp;status={selling/soldout}</p>
      </li>
      <li>
        <p>상품 제거</p>

        <p><strong>DELETE</strong> /api/v1/products/{product ID}</p>
      </li>
      <li>
        <p>상품 상세 조회</p>

        <p><strong>GET</strong> /api/v1/products/{product ID}</p>
      </li>
      <li>
        <p>상품 전체 조회 (파라미터 : 지역, 키워드, 카테고리)</p>

        <p><strong>GET</strong> /api/v1/products</p>

        <p>?resion={}&amp;keyword={}&amp;category={}</p>
      </li>
    </ul>
  </li>
  <li><strong>나의 당근</strong>
    <ul>
      <li>
        <p>판매내역, 구매내역, 관심목록 전체 조회</p>

        <p><strong>GET</strong> /api/v1/users/{user ID}</p>

        <p>?list={sale,purchase,heart}</p>
      </li>
      <li>
        <p>키워드 알림, 동네 등록</p>

        <p><strong>POST</strong> /api/vi/users/{user ID}</p>

        <p>?notification={}&amp;resion={}</p>
      </li>
    </ul>
  </li>
  <li><strong>채팅</strong>
    <ul>
      <li>
        <p>채팅방 생성</p>

        <p><strong>POST</strong> /api/v1/rooms</p>
      </li>
      <li>
        <p>채팅방 조회</p>

        <p><strong>GET</strong> /api/v1/rooms/{room ID}</p>
      </li>
      <li>
        <p>채팅방 제거</p>

        <p><strong>DELETE</strong> /api/v1/rooms/{room ID}</p>
      </li>
    </ul>
  </li>
  <li><strong>알림</strong>
    <ul>
      <li>
        <p>알림 발송</p>

        <p><strong>POST</strong> /api/v1/notifications</p>
      </li>
    </ul>
  </li>
</ol>

<p>이렇게 생각해봤는데 처음 해보는거라 이게 맞는지도 잘 모르겠다ㅋㅋ</p>

<p>그래도 일단 해보기로</p>

<p>고고</p>

<p>#당근마켓클론 #당근마켓좋아 #이글을본다면당근을흔들어줘</p>

<p>#취준생 #백수 #재밌는개발이나하자</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2020/08/19/video.js%E1%84%85%E1%85%B3%E1%86%AF-%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%92%E1%85%A1%E1%86%AB-%E1%84%8B%E1%85%B0%E1%86%B8-%E1%84%91%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%A5-%E1%84%86%E1%85%A1%E1%86%AB%E1%84%83%E1%85%B3%E1%86%AF%E1%84%80%E1%85%B5/">
        video.js를 이용한 웹 플레이어 만들기
      </a>
    </h1>

    <span class="post-date">19 Aug 2020</span>

    <p><a href="https://videojs.com/">video.js</a> 오픈 소스를 활용하여 웹 플레이어를 만들어 보려고 한다.</p>

<p>CDN 형식으로도 사용 가능하지만 기능을 살짝 변경해 볼 예정이라 소스를 직접 받았다.  (<a href="https://videojs.com/getting-started/#customize">참고</a>)</p>

<h3 id="1-프로젝트-폴더를-만들고-videojs를-설치한다">1. 프로젝트 폴더를 만들고 video.js를 설치한다.</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>my-web-player <span class="o">&amp;&amp;</span> <span class="nb">cd </span>my-web-player
<span class="nv">$ </span>npm init <span class="nt">-y</span>
<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">--save-dev</span> video.js
</code></pre></div></div>

<p>이제 video.js 모듈을 이용해 로컬 영상 혹은 유튜브 영상을 재생해 보려고 한다.</p>

<p>로컬 영상을 재생 하려면 2번 부터, 유튜브 영상 재생은 3번 부터 보면 된다.</p>

<h3 id="2-아래-명령어로-static-폴더를-생성한다">2. 아래 명령어로 static 폴더를 생성한다.</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> public/<span class="o">{</span>img,video,js<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>샘플 이미지를 img 폴더에 test_poster.png 로 저장한다. (대표 이미지용)</li>
</ul>

<p><img src="/public/images/video.js를 이용한 웹 플레이어 만들기/test_poster.png" alt="샘플이미지" width="70%" height="30%" /></p>

<p>샘플 이미지</p>

<ul>
  <li>테스트 할 동영상을 video 폴더에 test.mp4 로 저장한다. (난 <a href="https://www.youtube.com/watch?v=LXb3EKWsInQ&amp;t=79s">유튜브 영상</a>을 다운로드 받았다.)</li>
</ul>

<h3 id="3-js-폴더에-my-playerjs-파일을-만들고-아래-코드를-작성한다">3. js 폴더에 my-player.js 파일을 만들고 아래 코드를 작성한다.</h3>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-player</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">controls</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">autoplay</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">preload</span><span class="p">:</span> <span class="dl">'</span><span class="s1">auto</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">width</span><span class="p">:</span> <span class="dl">'</span><span class="s1">640</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">height</span><span class="p">:</span> <span class="dl">'</span><span class="s1">264</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">poster</span><span class="p">:</span> <span class="dl">'</span><span class="s1">img/test_poster.png</span><span class="dl">'</span> <span class="c1">// 로컬 영상만 추가</span>
<span class="p">});</span>
<span class="nx">player</span><span class="p">.</span><span class="nx">src</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">video/mp4</span><span class="dl">'</span><span class="p">,</span> <span class="na">src</span><span class="p">:</span> <span class="dl">'</span><span class="s1">video/test.mp4</span><span class="dl">'</span> <span class="p">});</span> <span class="c1">//로컬 영상만 추가</span>
</code></pre></div></div>

<h3 id="4-public-폴더에-indexhtml-파일을-만들고-아래-코드를-작성한다">4. public 폴더에 index.html 파일을 만들고 아래 코드를 작성한다.</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">--save</span> videojs-youtube // 유튜브 영상을 스트리밍하기 위해 설치한다.
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>

<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>My Web Player<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"video-js.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="c">&lt;!-- 로컬 영상은 아래의 body를 이용 --&gt;</span>
<span class="nt">&lt;body&gt;</span>
	<span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"my-player"</span> <span class="na">class=</span><span class="s">"video-js"</span> <span class="na">data-setup=</span><span class="s">"{}"</span><span class="nt">&gt;&lt;/video&gt;</span>
        
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"video.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/my-player.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="c">&lt;!-- 유튜브 영상은 아래의 body를 이용 --&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"my-player"</span> <span class="na">class=</span><span class="s">"video-js"</span> <span class="na">data-setup=</span><span class="s">'{ "techOrder": ["youtube"], "sources": [{ "type": "video/youtube", "src": "https://www.youtube.com/watch?v=LXb3EKWsInQ&amp;t=79s"}] }'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/video&gt;</span>
      
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"video.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"Youtube.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/my-player.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<h3 id="5-서버-측-코드를-작성하기-위해-express를-설치하고-루트에-appjs를-생성하여-아래-샘플을-작성한다">5. 서버 측 코드를 작성하기 위해 express를 설치하고 루트에 app.js를 생성하여 아래 샘플을 작성한다.</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">--save</span> express
</code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">public</span><span class="dl">'</span><span class="p">)));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">node_modules/video.js/dist</span><span class="dl">'</span><span class="p">)));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kd">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">node_modules/videojs-youtube/dist</span><span class="dl">'</span><span class="p">)));</span> <span class="c1">// 유튜브 재생만 추가</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">index.html</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">My Web Player server listening on port 3000</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<ul>
  <li>package.json은 아래와 같다.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-web-player"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node app"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"video.js"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^7.7.5"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"express"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.17.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"videojs-youtube"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.6.1"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>현재까지 완성된 프로젝트 구조는 아래와 같다.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">.</span>
├── app.js
├── node_modules
├── package-lock.json
├── package.json
└── public
    ├── img
    │   └── test_poster.png
    ├── index.html
    └── video
        └── test.mp4
</code></pre></div></div>

<ul>
  <li>프로젝트 루트에서 아래 명령어로 서버를 실행하고 <a href="http://localhost:3000">localhost:3000</a>으로 접속한다.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm start
</code></pre></div></div>

<h3 id="결과-화면">결과 화면</h3>

<p><img src="/public/images/video.js를 이용한 웹 플레이어 만들기/result.png" alt="결과 화면" width="70%" height="30%" /></p>

<p>👏잘 나온다.</p>

<p>마지막으로 <a href="https://github.com/videojs/themes">테마</a>를 forest로 변경하려고 한다. 아래 코드를 head에 추가하고</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
	<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://unpkg.com/@videojs/themes@1/dist/forest/index.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div></div>

<p>video태그의 class에 vjs-theme-forest를 추가한다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">video</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">my-player</span><span class="dl">"</span> <span class="kd">class</span><span class="o">=</span><span class="dl">"</span><span class="s2">video-js vjs-theme-forest</span><span class="dl">"</span> <span class="nx">data</span><span class="o">-</span><span class="nx">setup</span><span class="o">=</span><span class="dl">"</span><span class="s2">{}</span><span class="dl">"</span><span class="o">&gt;</span><span class="p">&lt;</span><span class="err">/</span><span class="nt">video</span><span class="p">&gt;</span>
</code></pre></div></div>

<h3 id="forest-테마를-적용한-결과-화면">forest 테마를 적용한 결과 화면</h3>

<p><img src="/public/images/video.js를 이용한 웹 플레이어 만들기/forest_result.png" alt="forest테마 적용" width="70%" height="30%" /></p>

<p>이제 <a href="https://docs.videojs.com/">video.js</a> 문서를 참고하여 몇 가지 기능들을 추가할 것이다.</p>

<h3 id="shortcut-기능-추가">shortcut 기능 추가</h3>

<p><a href="https://www.notion.so/5b2625c969194520b6e456cc28ed7019">기본값</a></p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// hotkeys를 true로 활성화하면 기본값이 적용된다.</span>
<span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-player</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">userActions</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">hotkeys</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// event를 이용해 숏컷을 수정할 수 있다. 재생/일시정지 key를 enter로 변경한 예시이다.</span>
<span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-player</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">userActions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">hotkeys</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">which</span> <span class="o">===</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">()){</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
                <span class="p">}</span>                
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">player</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span> <span class="c1">// 영상 컴포넌트에 초점을 맞춘다.</span>
</code></pre></div></div>

<h3 id="2-유동적인-화면">2. 유동적인 화면</h3>

<ul>
  <li>fluid 옵션을 true로 설정하면, 플레이어가 화면 크기에 유동적으로 맞춰진다.</li>
</ul>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">videojs</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-player</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
	<span class="na">fluid</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
</code></pre></div></div>

<p>이외에도 여러가지 기능들을 원하는 대로 변경해서 나만의 플레이어를 만들 수 있다.</p>

<h3 id="최종-결과">최종 결과</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lSPktX-ZboQ" frameborder="0" allowfullscreen=""></iframe>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2020/04/23/%E1%84%8C%E1%85%A1%E1%84%87%E1%85%A1%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%B8%E1%84%90%E1%85%B3-API-%E1%84%86%E1%85%AE%E1%86%AB%E1%84%89%E1%85%A5%E1%84%92%E1%85%AA-%E1%84%83%E1%85%A9%E1%84%80%E1%85%AE-JSDoc/">
        자바스크립트 API 문서화 도구 JSDoc
      </a>
    </h1>

    <span class="post-date">23 Apr 2020</span>

    <p><a href="https://jsdoc.app/">jsdoc</a>은 주석을 파싱하여 문서로 만들어 주는 편리한 문서화 도구이다.</p>

<h3 id="jsdoc-설치">jsdoc 설치</h3>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">--save</span> jsdoc</code></pre></figure>

<h3 id="jsdoc-테마-설치">jsdoc 테마 설치</h3>

<ul>
  <li><a href="https://cancerberosgx.github.io/jsdoc-templates-demo/demo/">여기</a>서 여러 테마를 볼 수 있다. 나는 <a href="https://www.npmjs.com/package/clean-jsdoc-theme">clean-jsdoc-theme</a> 테마를 적용했다.</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nv">$ </span>npm <span class="nb">install </span>clean-jsdoc-theme</code></pre></figure>

<h3 id="설정-파일-작성">설정 파일 작성</h3>

<ul>
  <li>루트 경로에 jsdoc.conf 혹은 jsdoc.json 생성 후 설정할 내용을 적는다. ( <a href="https://jsdoc.app/about-configuring-jsdoc.html">참조</a> )</li>
</ul>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nv">$ </span><span class="nb">touch </span>jsdoc.conf</code></pre></figure>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"."</span><span class="p">],</span><span class="w">
    </span><span class="nl">"includePattern"</span><span class="p">:</span><span class="w"> </span><span class="s2">".js$"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exclude"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"node_modules/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"logs/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"docs/"</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"opts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node_modules/clean-jsdoc-theme"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"encoding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"utf8"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"destination"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./docs/"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"recurse"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"verbose"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"templates"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"cleverLinks"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"monospaceLinks"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>한 줄씩 살펴보면</p>

<ul>
  <li><strong>source</strong>
    <ul>
      <li><strong>include</strong> : 문서화 할 파일들을 포함하는 경로</li>
      <li><strong>includePattern</strong> : 정규식 문자열로, 모든 파일 이름이 이 정규식과 일치해야 JSDoc에서 처리된다.</li>
      <li><strong>exclude</strong> : 문서화 하지 않을 파일의 경로</li>
    </ul>
  </li>
  <li><strong>opts</strong>
    <ul>
      <li><strong>template</strong> : 적용할 테마 경로</li>
      <li><strong>encoding</strong> : 모든 소스 파일을 읽을 때 해당 인코딩이 적용. 기본 값은 utf8</li>
      <li><strong>destination</strong> : 문서가 만들어 질 폴더</li>
      <li><strong>recurse</strong> : 소스 파일과 튜토리얼을 스캔 할 때 서브 폴더로 반복한다.</li>
      <li><strong>verbose</strong> : JSDoc을 run 했을 때, 콘솔에 세부 정보를 보여준다.</li>
    </ul>
  </li>
  <li><strong>templates</strong>
    <ul>
      <li><strong>cleverLinks</strong> : true로 설정하면 URL 링크는 일반 텍스트를 사용하고 코드 링크는 모노 스페이스 글꼴을 사용한다.</li>
      <li><strong>monospaceLinks</strong> : true로 설정하면 {@linkplain} 태그로 만든 링크를 제외하고 모든 링크가 모노 스페이스 글꼴을 사용한다.</li>
    </ul>
  </li>
</ul>

<h3 id="jsdoc-실행-명령어-스크립트-작성">JSDoc 실행 명령어 스크립트 작성</h3>

<ul>
  <li>package.json 을 열어 scripts 에 아래 내용을 추가한다.
    <ul>
      <li>—configure, -c : 설정 파일 적용</li>
      <li>—readme, -R : README 파일을 문서에 포함한다</li>
      <li>—private, -p : Private member를 문서에 포함한다</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"generate-docs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jsdoc -c ./jsdoc.conf -R ./README.md -p"</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<h3 id="jsdoc-실행">JSDoc 실행</h3>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nv">$ </span>npm run generate-docs</code></pre></figure>

<p>아래와 같이 docs 폴더가 생성되었다.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">.
├── docs
├── jsdoc.conf
├── node_modules
├── package.json
├── README.md
├── ...</code></pre></figure>

<p>docs 폴더 안의 index.html를 열어 문서를 확인해본다.</p>

<p>👏끝</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2020/04/18/%E1%84%8F%E1%85%A9%E1%84%90%E1%85%B3%E1%86%AF%E1%84%85%E1%85%B5%E1%86%AB-%E1%84%80%E1%85%B5%E1%84%87%E1%85%A9%E1%86%AB-%E1%84%86%E1%85%AE%E1%86%AB%E1%84%87%E1%85%A5%E1%86%B8-%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%85%E1%85%B5/">
        코틀린 기본 문법 정리
      </a>
    </h1>

    <span class="post-date">18 Apr 2020</span>

    <h3 id="인프런-강의---3-basic-syntax를-정리했습니다"><a href="https://www.inflearn.com/course/%EC%BD%94%ED%8B%80%EB%A6%B0-%EA%B0%95%EC%A2%8C-%EC%83%88%EC%B0%A8%EC%9B%90">인프런</a> 강의 - 3. <a href="https://youtu.be/zoYXKQImmwg">Basic syntax</a>를 정리했습니다.</h3>

<p><a href="https://try.kotlinlang.org/#/Examples/Hello,%20world!/Simplest%20version/Simplest%20version.kt">코틀린 테스트 해 볼 수 있는 사이트</a></p>

<ul>
  <li>패키지 정의
    <ul>
      <li>패키지 정의는 파일 최상단에 위치</li>
      <li>디텍터리와 패키지를 일치시키지 않아도 됨</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="k">package</span> <span class="nn">my.demo</span>
    <span class="k">import</span> <span class="nn">java.util.*</span></code></pre></figure>

<ul>
  <li>함수 정의
    <ul>
      <li>함수는 <strong>fun</strong> 키워드로 정의</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="k">fun</span> <span class="nf">sum</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span><span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span>
    <span class="p">}</span>
    
    <span class="c1">// 함수 몸체가 식(Expression)인 경우 return 생략가능</span>
    <span class="c1">// return type이 추론됨</span>
    <span class="k">fun</span> <span class="nf">sum</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="n">a</span> <span class="p">+</span> <span class="n">b</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="c1">// return 값 없는 경우 Unit(Object)으로 리턴 함</span>
    <span class="c1">// Unit은 Java에서 void 리턴 역할</span>
    <span class="k">fun</span> <span class="nf">printKotlin</span><span class="p">():</span> <span class="nc">Unit</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"hello Kotlin"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1">// Unit 생략가능</span>
    <span class="k">fun</span> <span class="nf">printKotlin</span><span class="p">(){</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"hello Kotlin"</span><span class="p">)</span>
    <span class="p">}</span></code></pre></figure>

<ul>
  <li>지역 변수 정의
    <ul>
      <li>val: 읽기 전용 변수, 값의 할당이 1회만 가능, Java의 final과 유사</li>
      <li>var: Mutable 변수</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="kd">val</span> <span class="py">a</span><span class="p">:</span><span class="nc">Int</span> <span class="p">=</span> <span class="m">1</span> <span class="c1">// 즉시 할당</span>
    <span class="kd">val</span> <span class="py">b</span> <span class="p">=</span> <span class="m">2</span>  <span class="c1">// 'Int' type 추론</span>
    <span class="kd">val</span> <span class="py">c</span><span class="p">:</span> <span class="nc">Int</span> <span class="c1">// 컴파일 오류, 초기화 필요</span>
    <span class="n">c</span> <span class="p">=</span> <span class="m">3</span> <span class="c1">// 컴파일 오류, 읽기 전용</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="kd">var</span> <span class="py">x</span> <span class="p">=</span> <span class="m">3</span>
    <span class="n">x</span> <span class="p">+=</span> <span class="m">1</span></code></pre></figure>

<ul>
  <li>주석
    <ul>
      <li>기본적으로 Java와 동일하지만, block comment가 Java와 다르게 중첩 허용됨</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="c1">// 한줄 주석</span>
    <span class="cm">/* 여러줄</span><span class="err">
</span><span class="cm">        주석 */</span>
    <span class="cm">/*
        /* 중첩 가능 */</span><span class="err">
</span><span class="cm">    */</span></code></pre></figure>

<ul>
  <li>문자열 템플릿
    <ul>
      <li>String Interpolation (문자열 보간법)</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="kd">var</span> <span class="py">a</span> <span class="p">=</span> <span class="m">1</span>
    <span class="kd">val</span> <span class="py">s1</span> <span class="p">=</span> <span class="s">"a is $a"</span>
    <span class="nf">println</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="c1">// a is 1</span>
    
    <span class="n">a</span> <span class="p">=</span> <span class="m">2</span>
    <span class="nf">println</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span> <span class="c1">// a is 1</span>
    
    <span class="kd">val</span> <span class="py">s2</span> <span class="p">=</span> <span class="s">"${s1.replace("</span><span class="k">is</span><span class="s">","</span><span class="n">was</span><span class="s">")}, but now is $a"</span>
    <span class="nf">println</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span> <span class="c1">// a was 1, but now is 2</span></code></pre></figure>

<ul>
  <li>조건문</li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="k">fun</span> <span class="nf">maxOf</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="p">&gt;</span> <span class="n">b</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">a</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="n">b</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// 조건식으로 사용가능</span>
    <span class="k">fun</span> <span class="nf">maxOf</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="p">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="n">a</span> <span class="k">else</span> <span class="n">b</span></code></pre></figure>

<ul>
  <li>nullable
    <ul>
      <li>값이 null 일 수 있는 경우 타입에 nullable 마크를 명시 해야 함</li>
      <li>nullable 타입의 변수 접근 시, 반드시 null 체크 해야 함 (컴파일 오류)</li>
      <li>강의 예시에는 printProduct함수 안에서 parseInt()를 사용하는데 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.js/parse-int.html">공식문서</a>를 보니 현재는 toInt()로 바뀐 듯!</li>
      <li>printProduct 함수에 nullable 마크도 없어서 추가함</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="k">fun</span> <span class="nf">parseInt</span><span class="p">(</span><span class="n">str</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Int</span><span class="p">?{</span>
        <span class="c1">// 정수가 아닌 경우 null을 리턴</span>
    <span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="k">fun</span> <span class="nf">printProduct</span><span class="p">(</span><span class="n">arg1</span><span class="p">:</span> <span class="nc">String</span><span class="p">?,</span> <span class="n">arg2</span><span class="p">:</span> <span class="nc">String</span><span class="p">?){</span>
        <span class="kd">val</span> <span class="py">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="n">arg1</span><span class="o">?.</span><span class="nf">toInt</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">=</span> <span class="n">arg2</span><span class="o">?.</span><span class="nf">toInt</span><span class="p">()</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">y</span> <span class="p">!=</span> <span class="k">null</span><span class="p">){</span>
            <span class="nf">println</span><span class="p">(</span><span class="n">x</span><span class="p">*</span><span class="n">y</span><span class="p">)</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"either '$arg1' or '$arg2' is not a number"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nf">printProduct</span><span class="p">(</span><span class="s">"10"</span><span class="p">,</span> <span class="s">"11"</span><span class="p">)</span> <span class="c1">// 110</span>
    <span class="nf">printProduct</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="s">"11"</span><span class="p">)</span> <span class="c1">// either 'null' or '11' is not a number</span>
    <span class="nf">printProduct</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="c1">// either 'null' or 'null' is not a number</span></code></pre></figure>

<ul>
  <li>자동 타입 변환
    <ul>
      <li>is : 타입 체크와 자동으로 타입 변환 됨</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="k">fun</span> <span class="nf">getStringLength</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nc">Any</span><span class="p">):</span> <span class="nc">Int</span><span class="p">?{</span>
        
        <span class="c1">// obj가 자동으로 String 타입으로 변환 됨</span>
        <span class="k">if</span><span class="p">(</span><span class="n">obj</span> <span class="k">is</span> <span class="nc">String</span><span class="p">){</span>
            <span class="k">return</span> <span class="n">obj</span><span class="p">.</span><span class="n">length</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">null</span>
    <span class="p">}</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="nf">getStringLength</span><span class="p">(</span><span class="s">"hi"</span><span class="p">))</span> <span class="c1">// 2</span>
    <span class="nf">println</span><span class="p">(</span><span class="nf">getStringLength</span><span class="p">(</span><span class="m">1234</span><span class="p">))</span> <span class="c1">// null</span></code></pre></figure>

<ul>
  <li>
    <p>while loop는 자바와 동일</p>
  </li>
  <li>
    <p>when expression</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="k">fun</span> <span class="nf">describe</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nc">Any</span><span class="p">):</span> <span class="nc">String</span> <span class="p">=</span>
        <span class="k">when</span><span class="p">(</span><span class="n">obj</span><span class="p">){</span>
            <span class="m">1</span> <span class="p">-&gt;</span> <span class="s">"One"</span>
            <span class="s">"Hello"</span> <span class="p">-&gt;</span> <span class="s">"good"</span>
            <span class="k">is</span> <span class="nc">Long</span> <span class="p">-&gt;</span> <span class="s">"Long"</span>
            <span class="p">!</span><span class="k">is</span> <span class="nc">String</span> <span class="p">-&gt;</span> <span class="s">"Not a string"</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="s">"unknown"</span>
        <span class="p">}</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="nf">describe</span><span class="p">(</span><span class="m">12</span><span class="p">))</span> <span class="c1">// Not a string</span>
    <span class="nf">println</span><span class="p">(</span><span class="nf">describe</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">))</span> <span class="c1">// good</span>
    <span class="nf">println</span><span class="p">(</span><span class="nf">describe</span><span class="p">(</span><span class="m">9999999999</span><span class="p">))</span> <span class="c1">// Long</span>
    <span class="nf">println</span><span class="p">(</span><span class="nf">describe</span><span class="p">(</span><span class="s">"끝"</span><span class="p">))</span> <span class="c1">// unknown</span></code></pre></figure>

<ul>
  <li>ranges
    <ul>
      <li>in 연산자로 숫자 범위 체크</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="kd">val</span> <span class="py">x</span> <span class="p">=</span> <span class="m">3</span>
    <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="m">1</span><span class="o">..</span><span class="m">10</span><span class="p">){</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"${x}은 1이상 10이하 입니다."</span><span class="p">)</span> <span class="c1">// 3은 1이상 10이하 입니다.</span>
    <span class="p">}</span>
    
    <span class="c1">// range를 이용한 for loop</span>
    <span class="k">for</span><span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="m">1</span><span class="o">..</span><span class="m">5</span><span class="p">){</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1">// 12345</span>
    <span class="p">}</span></code></pre></figure>

<ul>
  <li>collections
    <ul>
      <li>크게 List, Set, Map으로 나뉜다.</li>
      <li>컬렉션도 in으로 loop</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="kd">val</span> <span class="py">items</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"사과"</span><span class="p">,</span> <span class="s">"바나나"</span><span class="p">,</span> <span class="s">"키위"</span><span class="p">)</span>
    <span class="k">for</span><span class="p">(</span><span class="n">item</span> <span class="k">in</span> <span class="n">items</span><span class="p">){</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="c1">// 사과바나나키위</span>
    <span class="p">}</span>
    
    <span class="c1">// in으로 해당 값이 collection에 포함되어 있는지 체크 가능</span>
    <span class="kd">val</span> <span class="py">items</span> <span class="p">=</span> <span class="nf">setOf</span><span class="p">(</span><span class="s">"강아지"</span><span class="p">,</span> <span class="s">"고양이"</span><span class="p">,</span> <span class="s">"돼지"</span><span class="p">)</span>
    <span class="k">when</span><span class="p">{</span>
        <span class="s">"강아지"</span> <span class="k">in</span> <span class="n">items</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"강아지가 들어있네요"</span><span class="p">)</span> <span class="c1">// 강아지가 들어있네요</span>
        <span class="s">"사슴"</span> <span class="k">in</span> <span class="n">items</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"사슴이 들어있네요"</span><span class="p">)</span>
    <span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin">    <span class="c1">// 람다식을 이용해 컬렉션에 filter, map 등의 연산 가능</span>
    <span class="kd">val</span> <span class="py">fruits</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"한글"</span><span class="p">,</span> <span class="s">"훈민정음"</span><span class="p">,</span> <span class="s">"한 그루의 tree"</span><span class="p">,</span> <span class="s">"한국"</span><span class="p">)</span>
    <span class="n">fruits</span>
        <span class="p">.</span><span class="nf">filter</span><span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">sortedBy</span><span class="p">{</span> <span class="n">it</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">map</span><span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toUpperCase</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">forEach</span><span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
    
    <span class="cm">/*</span><span class="err">
</span><span class="cm">        한 그루의 TREE</span><span class="err">
</span><span class="cm">        한국</span><span class="err">
</span><span class="cm">        한글</span><span class="err">
</span><span class="cm">    */</span></code></pre></figure>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="//2020/03/07/Node.js-log-%E1%84%80%E1%85%B5%E1%84%85%E1%85%A9%E1%86%A8-%E1%84%86%E1%85%A9%E1%84%83%E1%85%B2%E1%86%AF-winston-%E1%84%89%E1%85%A1%E1%84%8B%E1%85%AD%E1%86%BC%E1%84%87%E1%85%A1%E1%86%BC%E1%84%87%E1%85%A5%E1%86%B8/">
        Node.js log 기록 모듈 winston 사용방법
      </a>
    </h1>

    <span class="post-date">07 Mar 2020</span>

    <p>log를 기록하기 위해 npm 모듈을 알아보던 중 winston이라는 모듈을 발견했다. 설명이 잘되어 있으며 사용방법도 간편하고 인기가 많은 모듈이기도 해서 선택했다.</p>

<p><a href="https://basketdeveloper.tistory.com/42">여기</a>와 <a href="https://www.npmjs.com/package/winston">winston</a>을 참고하면서 만들어봤다.</p>

<h3 id="1-필요한-모듈-설치">1. 필요한 모듈 설치</h3>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">npm <span class="nb">install</span> <span class="nt">--save</span> winston winston-daily-rotate-file moment-timezone</code></pre></figure>

<p>winston모듈 이외에 2개의 모듈이 더 있는데 winston-daily-rotate-file 모듈은 날짜별로 로그 파일을 생성할 수 있으며 파일 용량의 제한을 두거나 오래된 log파일을 알아서 제거해주는 편리한 모듈이다. 그리고  winston의 timezone은 기본적으로 UTC이기 때문에 한국 시간을 기록하기 위해 moment-timezone 모듈을 사용하여 timezone을 서울로 대체한다.</p>

<h3 id="2-momentjs-파일을-생성하여-타임존-한국시간으로-설정">2. moment.js 파일을 생성하여 타임존 한국시간으로 설정</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">moment-timezone</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">moment</span><span class="p">.</span><span class="nx">tz</span><span class="p">.</span><span class="nx">setDefault</span><span class="p">(</span><span class="dl">"</span><span class="s2">Asia/Seoul</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">;</span></code></pre></figure>

<h3 id="3-logjs-파일을-생성하여-winston-함수-및-포맷-정의">3. log.js 파일을 생성하여 winston 함수 및 포맷 정의</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 위에서 작성한 moment.js 모듈을 불러온다.</span>
<span class="kd">const</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./moment</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">winston</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">winston</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">winston-daily-rotate-file</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// winston의 사용할 함수들</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">addColors</span><span class="p">,</span> <span class="nx">createLogger</span><span class="p">,</span> <span class="nx">transports</span><span class="p">,</span> <span class="nx">format</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">winston</span><span class="p">;</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">combine</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">printf</span><span class="p">,</span> <span class="nx">colorize</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">format</span><span class="p">;</span>

<span class="c1">// log파일이 기록될 폴더 경로</span>
<span class="kd">const</span> <span class="nx">LOG_DIR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./logs/log</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ERR_DIR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./logs/error</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">EXCEPTION_DIR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./logs/exception</span><span class="dl">'</span><span class="p">;</span>

<span class="cm">/*
 * 로그 레벨 : { emerg: 0, alert: 1, crit: 2, error: 3, warning: 4, notice: 5, info: 6, debug: 7 }
 */</span>

<span class="c1">// 레벨 별 출력 color를 설정</span>
<span class="nx">addColors</span><span class="p">({</span>
    <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">red</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">warn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">yellow</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">info</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cyan</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">debug</span><span class="p">:</span> <span class="dl">'</span><span class="s1">green</span><span class="dl">'</span>
<span class="p">});</span>

<span class="c1">// 로그 출력 포맷 정의</span>
<span class="kd">const</span> <span class="nx">logFormat</span> <span class="o">=</span> <span class="nx">printf</span><span class="p">(({</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">timestamp</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">timestamp</span><span class="p">}</span><span class="s2"> [</span><span class="p">${</span><span class="nx">label</span><span class="p">}</span><span class="s2">] </span><span class="p">${</span><span class="nx">level</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// 타임존이 서울인 moment를 사용하여 타임스탬프 포맷 정의</span>
<span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">format</span><span class="p">((</span><span class="nx">info</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">info</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">'</span><span class="s1">YYYY-MM-DD, hh:mm:ss a</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">info</span><span class="p">;</span>
<span class="p">});</span></code></pre></figure>

<center>출력 예시</center>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">2020-03-07, 04:39:15 pm <span class="o">[</span>라벨이름] info: 로그를 출력합니다.</code></pre></figure>

<h3 id="4-개발용-콘솔-transport-옵션-설정">4. 개발용 콘솔 transport 옵션 설정</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">consoleTransport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">({</span>
    <span class="na">level</span><span class="p">:</span> <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">handleExceptions</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">json</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">format</span><span class="p">:</span> <span class="nx">combine</span><span class="p">(</span>
        <span class="nx">label</span><span class="p">({</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">라벨이름</span><span class="dl">'</span> <span class="p">}),</span>
        <span class="nx">timestamp</span><span class="p">(),</span>
        <span class="nx">colorize</span><span class="p">({</span> <span class="na">all</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}),</span> <span class="c1">// 컬러 출력</span>
        <span class="nx">logFormat</span>
    <span class="p">)</span>
<span class="p">});</span></code></pre></figure>

<h3 id="5-로거-생성">5. 로거 생성</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">createLogger</span><span class="p">({</span>
    <span class="na">level</span><span class="p">:</span> <span class="dl">"</span><span class="s2">info</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// info 레벨부터 로그를 남긴다. (debug 레벨은 찍히지 않는다)</span>
    <span class="na">datePattern</span><span class="p">:</span> <span class="dl">"</span><span class="s2">YYYY-MM-DD</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// rotating될 날짜 포맷</span>
    <span class="na">zippedArchive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// archive된 파일 압축 여부, 디폴트는 false</span>
    <span class="na">maxSize</span><span class="p">:</span> <span class="dl">"</span><span class="s2">20m</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 파일 당 최대 크기를 20mb로 설정</span>
    <span class="na">maxFiles</span><span class="p">:</span> <span class="dl">"</span><span class="s2">30d</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// 최근 30일간의 파일만 유지, 오래된 파일은 zippedArchive 설정에 따라 삭제 혹은 압축된다.</span>
    <span class="na">format</span><span class="p">:</span> <span class="nx">combine</span><span class="p">(</span>
        <span class="nx">label</span><span class="p">({</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">라벨 이름</span><span class="dl">'</span> <span class="p">}),</span>
        <span class="nx">timeStamp</span><span class="p">(),</span> <span class="c1">// 위에서 생성했던 타임스태프 포맷을 사용한다.</span>
        <span class="nx">logFormat</span><span class="p">,</span> <span class="c1">// 위에서 생성했던 로그 출력 포맷 형식을 사용한다.</span>
    <span class="p">),</span>
    <span class="na">transports</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// error 레벨부터 로그를 파일에 저장한다.</span>
        <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">DailyRotateFile</span><span class="p">({</span><span class="na">level</span><span class="p">:</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="na">dirname</span><span class="p">:</span><span class="s2">`</span><span class="p">${</span><span class="nx">ERR_DIR</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="na">filename</span><span class="p">:</span> <span class="s2">`error_%DATE%.log`</span><span class="p">}),</span>
        <span class="c1">// info 레벨부터 로그를 파일에 저장한다.</span>
        <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">DailyRotateFile</span><span class="p">({</span><span class="na">dirname</span><span class="p">:</span><span class="s2">`</span><span class="p">${</span><span class="nx">LOG_DIR</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="na">filename</span><span class="p">:</span> <span class="s2">`log_%DATE%.log`</span><span class="p">})</span> 
    <span class="p">],</span>
    <span class="na">exceptionHandlers</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// 예외상황 발생 시 로그를 파일에 저장한다.</span>
        <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">DailyRotateFile</span><span class="p">({</span><span class="na">dirname</span><span class="p">:</span><span class="s2">`</span><span class="p">${</span><span class="nx">EXCEPTION_DIR</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="na">filename</span><span class="p">:</span> <span class="s2">`exception_%DATE%.log`</span><span class="p">})</span>
    <span class="p">],</span>
    <span class="na">exitOnError</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">});</span></code></pre></figure>

<h3 id="6-모듈-내보내기">6. 모듈 내보내기</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 개발 시 콘솔 출력</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">consoleTransport</span><span class="p">)</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">isError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stack</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// 에러 발생 시 error 레벨 출력</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">isError</span><span class="p">(</span><span class="nx">info</span><span class="p">))</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">info</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ENV</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">info</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">info</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h3 id="7-logjs-최종">7. log.js 최종</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./moment</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">winston</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">winston</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">winston-daily-rotate-file</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="p">{</span> <span class="nx">addColors</span><span class="p">,</span> <span class="nx">createLogger</span><span class="p">,</span> <span class="nx">transports</span><span class="p">,</span> <span class="nx">format</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">winston</span><span class="p">;</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">combine</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">printf</span><span class="p">,</span> <span class="nx">colorize</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">format</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">LOG_DIR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./logs/log</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ERR_DIR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./logs/error</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">EXCEPTION_DIR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">./logs/exception</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">addColors</span><span class="p">({</span>
    <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">red</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">warn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">yellow</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">info</span><span class="p">:</span> <span class="dl">'</span><span class="s1">cyan</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">debug</span><span class="p">:</span> <span class="dl">'</span><span class="s1">green</span><span class="dl">'</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">logFormat</span> <span class="o">=</span> <span class="nx">printf</span><span class="p">(({</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">timestamp</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">timestamp</span><span class="p">}</span><span class="s2"> [</span><span class="p">${</span><span class="nx">label</span><span class="p">}</span><span class="s2">] </span><span class="p">${</span><span class="nx">level</span><span class="p">}</span><span class="s2">: </span><span class="p">${</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">format</span><span class="p">((</span><span class="nx">info</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">info</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="dl">'</span><span class="s1">YYYY-MM-DD, hh:mm:ss a</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">info</span><span class="p">;</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">consoleTransport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">Console</span><span class="p">({</span>
    <span class="na">level</span><span class="p">:</span> <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">handleExceptions</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">colorize</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">format</span><span class="p">:</span> <span class="nx">combine</span><span class="p">(</span>
        <span class="nx">label</span><span class="p">({</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">라벨이름</span><span class="dl">'</span> <span class="p">}),</span>
        <span class="nx">timestamp</span><span class="p">(),</span>
        <span class="nx">colorize</span><span class="p">({</span> <span class="na">all</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}),</span>
        <span class="nx">logFormat</span>
    <span class="p">)</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">createLogger</span><span class="p">({</span>
    <span class="na">level</span><span class="p">:</span> <span class="dl">"</span><span class="s2">info</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">datePattern</span><span class="p">:</span> <span class="dl">"</span><span class="s2">YYYY-MM-DD</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">zippedArchive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">maxSize</span><span class="p">:</span> <span class="dl">"</span><span class="s2">20m</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">maxFiles</span><span class="p">:</span> <span class="dl">"</span><span class="s2">30d</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">format</span><span class="p">:</span> <span class="nx">combine</span><span class="p">(</span>
        <span class="nx">label</span><span class="p">({</span> <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1">라벨 이름</span><span class="dl">'</span> <span class="p">}),</span>
        <span class="nx">timeStamp</span><span class="p">(),</span>
        <span class="nx">logFormat</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="na">transports</span><span class="p">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">DailyRotateFile</span><span class="p">({</span><span class="na">level</span><span class="p">:</span> <span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">,</span> <span class="na">dirname</span><span class="p">:</span><span class="s2">`</span><span class="p">${</span><span class="nx">ERR_DIR</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="na">filename</span><span class="p">:</span> <span class="s2">`error_%DATE%.log`</span><span class="p">}),</span>
        <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">DailyRotateFile</span><span class="p">({</span><span class="na">dirname</span><span class="p">:</span><span class="s2">`</span><span class="p">${</span><span class="nx">LOG_DIR</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="na">filename</span><span class="p">:</span> <span class="s2">`log_%DATE%.log`</span><span class="p">})</span> 
    <span class="p">],</span>
    <span class="na">exceptionHandlers</span><span class="p">:</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">transports</span><span class="p">.</span><span class="nx">DailyRotateFile</span><span class="p">({</span><span class="na">dirname</span><span class="p">:</span><span class="s2">`</span><span class="p">${</span><span class="nx">EXCEPTION_DIR</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="na">filename</span><span class="p">:</span> <span class="s2">`exception_%DATE%.log`</span><span class="p">})</span>
    <span class="p">],</span>
    <span class="na">exitOnError</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">consoleTransport</span><span class="p">)</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">isError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stack</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">isError</span><span class="p">(</span><span class="nx">info</span><span class="p">))</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">info</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ENV</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">info</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">info</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h3 id="8-사용">8. 사용</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./log</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">로그를 출력합니다.</span><span class="dl">'</span><span class="p">);</span></code></pre></figure>

<h3 id="결과-예시">결과 예시</h3>
<p><img src="/public/images/Node.js log 기록 모듈 winston 사용방법/console.png" alt="콘솔 로그" width="70%" height="30%" /></p>

<h3 id="로그-파일-구조-예시">로그 파일 구조 예시</h3>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log
├── error
│   └── error_2020-03-07.log
├── exception
│   └── exception_2020-03-07.log
└── log
    └── log_2020-03-07.log</code></pre></figure>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div> -->

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    

    <script>
      (function(document) {
        var toggle = document.querySelector(".sidebar-toggle");
        var sidebar = document.querySelector("#sidebar");
        var checkbox = document.querySelector("#sidebar-checkbox");

        document.addEventListener(
          "click",
          function(e) {
            var target = e.target;

            if (
              !checkbox.checked ||
              sidebar.contains(target) ||
              target === checkbox || target === toggle
            )
              return;

            checkbox.checked = false;
          },
          false
        );
      })(document);
    </script>
  </body>
</html>
